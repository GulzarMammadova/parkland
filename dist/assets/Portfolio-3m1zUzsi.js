import{c as ee,r as o,u as fe,R as e,m as te,s as L}from"./index-DrUG7fk5.js";import{u as ge}from"./use-in-view-DpFqT-IM.js";/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],he=ee("chevron-left",Ee);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],ye=ee("chevron-right",_e),M="projects",A="portfolio",F=4,Ne=/\.(jpe?g|png|webp|avif|gif)$/i,X=(t="")=>Ne.test(t);function V(t){return L.storage.from(M).getPublicUrl(t).data.publicUrl}async function be(t){const l=V(t),s=await fetch(l,{cache:"no-store"});if(!s.ok)throw new Error(`Failed to fetch ${t}: ${s.status}`);return s.json()}function we(t=""){return String(t).normalize("NFKD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}function D(t=""){return t.replace(/[-_]+/g," ").replace(/\s+/g," ").trim().split(" ").map(s=>s?s[0].toUpperCase()+s.slice(1):"").join(" ")}function Q(t=""){const l=t.split("--");return l.length<=1?"":D(l[1].replace(/\.[^.]+$/,"").replace(/[_-]\d+$/,""))}function ke(){const t=o.useRef(null),l=o.useRef(null),s=ge(t,{once:!0,amount:.2}),{lang:h}=fe(),[S,x]=o.useState({projects:{},clients:{}}),[i,w]=o.useState(0),[c,P]=o.useState(!1),[f,n]=o.useState(F),[z,O]=o.useState(!0),[ae,T]=o.useState([]),U={EN:{heading:"Featured Projects",seeAll:"VIEW MORE",loadMore:"SHOW MORE",empty:"Projects will appear here soon."},AZ:{heading:"Seçilmiş Layihələr",seeAll:"Hamısına bax",loadMore:"Daha çox göstər",empty:"Layihələr tezliklə burada görünəcək."}},v=U[h]||U.EN;o.useEffect(()=>{let a=!0;async function _(){try{O(!0);let d={projects:{},clients:{}};try{d=await be(`${A}/titles.json`)}catch(r){console.warn("No titles.json or failed to load:",r?.message)}a&&x(d);const{data:le,error:W}=await L.storage.from(M).list(A,{limit:1e3,sortBy:{column:"name",order:"asc"}});if(W)throw W;const Z=le||[],ce=Z.filter(r=>!r.metadata),ie=Z.filter(r=>r.metadata&&X(r.name)),me=(await Promise.all(ce.map(async r=>{const $=`${A}/${r.name}`,{data:j,error:y}=await L.storage.from(M).list($,{limit:1e3,sortBy:{column:"name",order:"asc"}});if(y)return console.warn("[Storage] inner list error:",$,y),null;const g=(j||[]).filter(u=>u.metadata&&X(u.name));if(!g.length)return null;g.sort((u,H)=>{const G=parseInt(u.name,10),J=parseInt(H.name,10);return isNaN(G)||isNaN(J)?u.name.localeCompare(H.name):G-J});const N=r.name,m=(d.projects||{})[N]||{},k=m.title?.en||D(N),I=m.title?.az||k,E=g.find(u=>u.name.includes("--")),b=(E?Q(E.name):"")||m.client?.en||"",de=b&&d.clients?.[b]?.az||m.client?.az||b,q=g.map(u=>V(`${$}/${u.name}`));return q.length?{slug:N,titleEn:k,titleAz:I,clientEn:b,clientAz:de,images:q}:null}))).filter(Boolean),ue=ie.map(r=>{const $=`${A}/${r.name}`,j=V($),y=r.name.replace(/\.[^/.]+$/,""),g=y.includes("--")?y.split("--")[0]:y.split("_")[0],N=we(g),m=(d.projects||{})[N]||{},k=m.title?.en||D(g),I=m.title?.az||k,E=Q(r.name)||m.client?.en||"",b=E&&d.clients?.[E]?.az||m.client?.az||E;return{slug:N,titleEn:k,titleAz:I,clientEn:E,clientAz:b,images:[j]}}),pe=[...me,...ue];a&&T(pe)}catch(d){console.error("Supabase load error:",d),a&&T([])}finally{a&&O(!1)}}return _(),()=>{a=!1}},[]);const R=ae,p=R.length,B=o.useMemo(()=>p<=1?[0]:[i%p,(i+1)%p],[i,p]),ne=()=>w(a=>(a-1+p)%p),re=()=>w(a=>(a+1)%p),se=new Set(B),C=R.filter((a,_)=>!se.has(_)),K=c?C.slice(0,f):[],oe=K.length>=C.length;return o.useEffect(()=>{c&&l.current&&l.current.scrollIntoView({behavior:"smooth",block:"start"})},[c]),e.createElement("section",{id:"portfolio",className:"portfolio section",ref:t},e.createElement("div",{className:"container portfolio__container"},e.createElement(te.div,{initial:{opacity:0,y:30},animate:s?{opacity:1,y:0}:{},transition:{duration:.8},className:"portfolio__header"},e.createElement("h2",{className:"portfolio__title"},v.heading),e.createElement("p",{className:"portfolio__sub"},v.sub)),!z&&p>1&&!c&&e.createElement(e.Fragment,null,e.createElement("button",{className:"portfolio__arrow portfolio__arrow--left",onClick:ne,"aria-label":"Previous project",type:"button"},e.createElement(he,{size:30})),e.createElement("button",{className:"portfolio__arrow portfolio__arrow--right",onClick:re,"aria-label":"Next project",type:"button"},e.createElement(ye,{size:30}))),e.createElement("div",{className:"portfolio__grid"},z?e.createElement(e.Fragment,null,e.createElement("div",{className:"pCard skeleton"}),e.createElement("div",{className:"pCard skeleton"})):B.map(a=>e.createElement(Y,{key:`feat-${a}`,project:R[a],inView:s,priority:!0,lang:h}))),!z&&!c&&C.length>0&&e.createElement("div",{className:"see-all-container"},e.createElement("button",{type:"button",className:"see-all-btn",onClick:()=>P(!0)},e.createElement("span",null,v.seeAll))),!z&&c&&e.createElement(e.Fragment,null,e.createElement("div",{ref:l,"aria-hidden":"true"}),e.createElement("div",{className:"portfolio__grid portfolio__grid--expanded"},K.map((a,_)=>e.createElement("div",{key:`${a.titleEn}-${_}`,className:"pl-appear",style:{animationDelay:`${_%F*80}ms`}},e.createElement(Y,{project:a,inView:!0,lang:h})))),!oe&&e.createElement("div",{className:"see-all-container"},e.createElement("button",{type:"button",className:"see-all-btn",onClick:()=>n(a=>Math.min(a+F,C.length))},e.createElement("span",null,v.loadMore))),C.length===0&&e.createElement("p",{className:"pl-empty",style:{textAlign:"center",marginTop:12}},v.empty))))}function Y({project:t,inView:l,priority:s=!1,lang:h}){if(!t)return null;const S=h==="AZ"&&t.titleAz||t.titleEn,x=h==="AZ"&&t.clientAz||t.clientEn,i=Array.isArray(t.images)&&t.images.length>0?t.images:["https://images.unsplash.com/photo-1612143241883-35889d1d65ab?auto=format&w=1200&q=80"],[w,c]=o.useState(0),P=f=>{f.key==="ArrowLeft"&&c(n=>(n-1+i.length)%i.length),f.key==="ArrowRight"&&c(n=>(n+1)%i.length)};return e.createElement(te.div,{layout:!0,initial:{opacity:0},animate:l?{opacity:1}:{},transition:{duration:.4,ease:[.22,.61,.36,1]},className:"pCard"},e.createElement("div",{className:"pCard__imageWrap",tabIndex:0,onKeyDown:P},i.map((f,n)=>e.createElement("div",{key:n,className:`pCard__imageStage ${n===w?"is-active":""}`},e.createElement("img",{className:"pCard__image",src:f,alt:`${S} ${n+1}`,loading:s&&n===0?"eager":"lazy"}))),e.createElement("div",{className:"pCard__overlay"})),e.createElement("div",{className:"pCard__text"},e.createElement("p",{className:"pCard__cat"},x||""),e.createElement("h3",{className:"pCard__title"},S||"")),e.createElement("div",{className:"pCard__bars"},i.map((f,n)=>e.createElement("button",{key:n,type:"button",className:`pCard__bar ${n===w?"is-active":""}`,onClick:()=>c(n)}))))}export{ke as Portfolio};
